<app-sidebar></app-sidebar>

<div class="patient-list-container">
  <!-- Header -->
  <header class="patient-list-header">
    <div class="header-content">
      <div class="back-link" (click)="goHome()">
        <i class="fas fa-arrow-left"></i>
        <span>Voltar ao in√≠cio</span>
      </div>
      <div class="header-title">
        <h1>Atendidos</h1>
      </div>
    </div>

    <button class="btn-primary" (click)="openModal()">
      <i class="fas fa-plus"></i> Novo Atendido
    </button>
  </header>

  <!-- Content with Shared Table -->
  <app-shared-table [data]="filteredPatients" [columns]="columns" [loading]="loading" [paginationMeta]="paginationMeta"
    [searchTerm]="searchTerm" [sortColumn]="sortColumn || ''" [sortDirection]="sortDirection || 'asc'"
    emptyMessage="Nenhum atendido encontrado." (search)="onSearch($event)" (sort)="onSort($event)"
    (pageChange)="onPageChange($event)" (rowClick)="onRowClick($event)">
  </app-shared-table>
</div>

<!-- Templates for Custom Columns -->
<ng-template #patientTpl let-item>
  <div class="patient-cell">
    <div class="avatar-mini">
      <img *ngIf="item.photo" [src]="item.photo" [alt]="item.full_name">
      <span *ngIf="!item.photo">{{ item.full_name.charAt(0) }}</span>
    </div>
    <div class="patient-info-cell">
      <span class="name">{{ item.full_name }}</span>
      <span class="sub-id">#{{ item.id }}</span>
    </div>
  </div>
</ng-template>

<ng-template #cpfTpl let-item>
  {{ formatCPF(item.cpf) }}
</ng-template>

<ng-template #ageTpl let-item>
  {{ getPatientAge(item.birth_date) }} anos
  <span class="birth-year">({{ item.birth_date | date:'yyyy' }})</span>
</ng-template>

<ng-template #genderTpl let-item>
  <span class="gender-badge" [class.male]="item.gender === 'M'" [class.female]="item.gender === 'F'">
    {{ item.gender === 'M' ? 'M' : 'F' }}
  </span>
</ng-template>

<ng-template #actionsTpl let-item>
  <div class="actions-cell">
    <button class="btn-icon edit" (click)="openModal(item); $event.stopPropagation()" title="Editar">
      <i class="fas fa-pencil"></i>
    </button>
    <button class="btn-icon delete" (click)="deletePatient(item.id!); $event.stopPropagation()" title="Excluir">
      <i class="fas fa-trash-can"></i>
    </button>
  </div>
</ng-template>

<!-- Create/Edit Patient Modal -->
<app-patient-form-modal [visible]="showCreateModal" [patient]="currentPatient" (close)="closeCreateModal()"
  (success)="onModalSuccess()"></app-patient-form-modal>