<div>
    <app-sidebar></app-sidebar>
    <div class="main-content">
        <header class="header-section">
            <div class="header-content">
                <div class="back-link" (click)="goHome()">
                    <i class="fas fa-arrow-left"></i>
                    <span>Voltar ao início</span>
                </div>
                <div class="header-title">
                    <h2>Lista de Atendimentos</h2>
                    <p class="subtitle">Gerencie os atendimentos e consultas do dia.</p>
                </div>
            </div>
            <button class="btn-primary" (click)="createAppointment()">
                <i class="fas fa-plus"></i> Novo Atendimento
            </button>
        </header>

        <!-- Mensagem de erro -->
        <div class="alert alert-error" *ngIf="errorMessage">
            <i class="fas fa-exclamation-circle"></i>
            {{ errorMessage }}
        </div>

        <app-shared-table [data]="appointments" [columns]="columns" [loading]="loading"
            [paginationMeta]="paginationMeta" [searchTerm]="filterText" emptyMessage="Nenhum atendimento encontrado."
            (search)="onSearch($event)" (pageChange)="onPageChange($event)" (rowClick)="onRowClick($event)">
        </app-shared-table>
    </div>
</div>

<!-- Templates for Custom Columns -->
<ng-template #patientTpl let-item>
    <div class="patient-cell">
        <div class="avatar">
            <span *ngIf="!item.patient?.photo">{{ getInitials(item.patient?.full_name || '') }}</span>
            <img *ngIf="item.patient?.photo" [src]="item.patient?.photo" alt="Avatar">
        </div>
        <div class="info">
            <span class="name">{{ item.patient?.full_name || 'Paciente não identificado' }}</span>
            <span class="sub-info">CPF: {{ formatCPF(item.patient?.cpf || '') }}</span>
        </div>
    </div>
</ng-template>

<ng-template #dateTpl let-item>
    <div class="date-cell">
        <span class="date">{{ formatDate(item.date) }}</span>
        <!-- Assuming backend doesn't return time yet, using placeholder or just date -->
        <!-- <span class="time">09:30 AM</span> -->
    </div>
</ng-template>

<ng-template #objectiveTpl let-item>
    <span class="badge badge-objective" [ngClass]="getObjectiveClass(item.objective)">
        {{ getObjectiveText(item.objective) }}
    </span>
</ng-template>

<ng-template #statusTpl let-item>
    <span class="status-dot-badge" [ngClass]="getStatusClass(item.status || '')">
        <i class="fas fa-circle"></i>
        {{ getStatusText(item.status || 'pending') }}
    </span>
</ng-template>

<app-appointment-details-modal [visible]="showDetailsModal" [appointment]="selectedAppointment"
    (close)="closeDetailsModal()" (edit)="onEditAppointment($event)">
</app-appointment-details-modal>