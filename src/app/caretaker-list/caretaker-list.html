<app-sidebar></app-sidebar>

<div class="caretaker-list-container">
  <header class="caretaker-list-header">
    <div class="header-content">
      <div class="back-link" (click)="goHome()">
        <i class="fas fa-arrow-left"></i>
        <span class="back-link">Voltar ao in√≠cio</span>
      </div>
      <div class="header-title">
        <h1>Cuidadores</h1>
      </div>
    </div>
    <button class="btn-primary" (click)="addCaretaker()">
      <i class="fas fa-plus"></i> Novo Cuidador
    </button>
  </header>

  <app-shared-table [data]="filteredCaretakers" [columns]="columns" [loading]="loading"
    [paginationMeta]="paginationMeta" [searchTerm]="searchTerm" [sortColumn]="sortColumn"
    [sortDirection]="sortDirection" emptyMessage="Nenhum cuidador encontrado." (search)="onSearch($event)"
    (sort)="onSort($event)" (pageChange)="onPageChange($event)" (rowClick)="onRowClick($event)">
  </app-shared-table>
</div>

<!-- Templates for Custom Columns -->
<ng-template #nameTpl let-item>
  <div class="caretaker-info-cell">
    <div class="caretaker-icon-small">
      <i class="fas fa-user-nurse"></i>
    </div>
    <div class="name-details">
      <span class="fullname">{{ item.full_name }}</span>
      <span class="id-sub">ID: {{ item.id }}</span>
    </div>
  </div>
</ng-template>

<ng-template #ageTpl let-item>
  {{ getCaretakerAge(item.birth_date) }} anos
</ng-template>

<ng-template #genderTpl let-item>
  <span class="gender-badge" [ngClass]="item.gender">
    {{ item.gender === 'M' ? 'M' : 'F' }}
  </span>
</ng-template>

<ng-template #kinshipTpl let-item>
  <div class="patients-cell">
    <ng-container *ngIf="item.patients && item.patients.length > 0; else noPatients">
      <div *ngFor="let p of item.patients | slice:0:2" class="patient-badge">
        <span class="p-name">{{ $any(p).full_name.split(' ')[0] }}</span>
        <span class="p-kinship">({{ getKinshipLabel($any(p).kinship) }})</span>
      </div>
      <div *ngIf="item.patients.length > 2" class="more-badge">
        +{{ item.patients.length - 2 }}
      </div>
    </ng-container>
    <ng-template #noPatients>
      <span class="text-muted">-</span>
    </ng-template>
  </div>
</ng-template>

<ng-template #actionsTpl let-item>
  <div class="actions-cell">
    <button class="btn-icon view" (click)="viewCaretaker(item.id!); $event.stopPropagation()" title="Visualizar">
      <i class="fas fa-eye"></i>
    </button>
    <button class="btn-icon edit" (click)="editCaretaker(item.id!); $event.stopPropagation()" title="Editar">
      <i class="fas fa-pencil"></i>
    </button>
    <button class="btn-icon delete" (click)="deleteCaretaker(item.id!); $event.stopPropagation()" title="Deletar">
      <i class="fas fa-trash-can"></i>
    </button>
  </div>
</ng-template>

<app-caretaker-form-modal [visible]="showCaretakerModal" [patientId]="currentCaretaker?.patient_id || null"
  [caretaker]="currentCaretaker" (close)="closeCaretakerModal()" (success)="onCaretakerSuccess()">
</app-caretaker-form-modal>