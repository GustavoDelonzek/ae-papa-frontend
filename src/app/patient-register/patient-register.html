<div class="patient-register-container">
  <app-sidebar></app-sidebar>
  
  <div class="main-content">
    
    <div class="form-container">
      <div class="content-header">
        <h1 class="page-title">{{ isEditing ? 'Editar Paciente' : 'Cadastro de Pacientes' }}</h1>
        <p class="page-subtitle">{{ isEditing ? 'Atualize os dados do paciente e salve.' : 'Preencha os dados do paciente para realizar o cadastro' }}</p>
      </div>
      <form class="patient-form" (ngSubmit)="onSubmit()" #patientForm="ngForm" novalidate>
        
        <!-- Nome Completo -->
        <div class="form-group">
          <label for="full_name" class="form-label">Nome Completo *</label>
          <input 
            type="text" 
            id="full_name"
            name="full_name"
            class="form-control"
            [(ngModel)]="patientData.full_name"
            required
            maxlength="255"
            #fullName="ngModel"
            placeholder="Digite o nome completo do paciente">
          
          <div *ngIf="fullName.invalid && fullName.touched" class="error-message">
            <small *ngIf="fullName.errors?.['required']" class="text-danger">
              Nome completo é obrigatório
            </small>
            <small *ngIf="fullName.errors?.['maxlength']" class="text-danger">
              Nome deve ter no máximo 255 caracteres
            </small>
          </div>
        </div>

        <!-- Data de Nascimento -->
        <div class="form-group">
          <label for="birth_date" class="form-label">Data de Nascimento *</label>
          <input 
            type="date" 
            id="birth_date"
            name="birth_date"
            class="form-control"
            [(ngModel)]="patientData.birth_date"
            required
            #birthDate="ngModel">
          
          <div *ngIf="birthDate.invalid && birthDate.touched" class="error-message">
            <small *ngIf="birthDate.errors?.['required']" class="text-danger">
              Data de nascimento é obrigatória
            </small>
          </div>
        </div>

        <!-- Gênero -->
        <div class="form-group">
          <label for="gender" class="form-label">Gênero *</label>
          <select 
            id="gender"
            name="gender"
            class="form-control"
            [(ngModel)]="patientData.gender"
            required
            #gender="ngModel">
            <option value="">Selecione o gênero</option>
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
          </select>
          
          <div *ngIf="gender.invalid && gender.touched" class="error-message">
            <small *ngIf="gender.errors?.['required']" class="text-danger">
              Gênero é obrigatório
            </small>
          </div>
        </div>

        <!-- Estado Civil -->
        <div class="form-group">
          <label for="marital_status" class="form-label">Estado Civil *</label>
          <select 
            id="marital_status"
            name="marital_status"
            class="form-control"
            [(ngModel)]="patientData.marital_status"
            required
            #maritalStatus="ngModel">
            <option value="">Selecione o estado civil</option>
            <option value="single">Solteiro(a)</option>
            <option value="married">Casado(a)</option>
            <option value="divorced">Divorciado(a)</option>
            <option value="widowed">Viúvo(a)</option>
          </select>
          
          <div *ngIf="maritalStatus.invalid && maritalStatus.touched" class="error-message">
            <small *ngIf="maritalStatus.errors?.['required']" class="text-danger">
              Estado civil é obrigatório
            </small>
          </div>
        </div>

        <!-- CPF -->
        <div class="form-group">
          <label for="cpf" class="form-label">CPF *</label>
          <input 
            type="text" 
            id="cpf"
            name="cpf"
            class="form-control"
            [(ngModel)]="patientData.cpf"
            required
            mask="000.000.000-00"
            #cpf="ngModel"
            placeholder="000.000.000-00">
          
          <div *ngIf="cpf.invalid && cpf.touched" class="error-message">
            <small *ngIf="cpf.errors?.['required']" class="text-danger">
              CPF é obrigatório
            </small>
            <small *ngIf="cpf.errors?.['mask']" class="text-danger">
              CPF deve ter formato válido
            </small>
          </div>
        </div>

        <!-- RG -->
        <div class="form-group">
          <label for="rg" class="form-label">RG</label>
          <input 
            type="text" 
            id="rg"
            name="rg"
            class="form-control"
            [(ngModel)]="patientData.rg"
            #rg="ngModel"
            placeholder="Digite o RG (opcional)">
          
          <div *ngIf="rg.invalid && rg.touched" class="error-message">
            <small class="text-danger">
              RG deve ser único
            </small>
          </div>
        </div>

        <!-- Seção de Endereço -->
        <div class="section-title">
          <h3>Endereço</h3>
        </div>

        <!-- CEP -->
        <div class="form-group">
          <label for="cep" class="form-label optional-field">CEP</label>
          <div class="input-with-loader">
            <input 
              type="text" 
              id="cep"
              name="cep"
              class="form-control"
              [(ngModel)]="addressData.cep"
              (ngModelChange)="onCepChange()"
              mask="00000-000"
              #cep="ngModel"
              placeholder="00000-000"
              [class.loading]="isLoadingCep">
            <span *ngIf="isLoadingCep" class="cep-loader">
              <i class="fas fa-spinner fa-spin"></i>
            </span>
          </div>
          <div *ngIf="cepError" class="error-message">
            <small class="text-danger">{{ cepError }}</small>
          </div>
        </div>

        <!-- Rua -->
        <div class="form-group">
          <label for="street" class="form-label optional-field">Rua</label>
          <input 
            type="text" 
            id="street"
            name="street"
            class="form-control"
            [(ngModel)]="addressData.street"
            maxlength="255"
            #street="ngModel"
            placeholder="Digite o nome da rua">
        </div>

        <!-- Número -->
        <div class="form-group">
          <label for="number" class="form-label optional-field">Número</label>
          <input 
            type="text" 
            id="number"
            name="number"
            class="form-control"
            [(ngModel)]="addressData.number"
            maxlength="20"
            #addressNumber="ngModel"
            placeholder="Nº">
        </div>

        <!-- Bairro -->
        <div class="form-group">
          <label for="neighborhood" class="form-label optional-field">Bairro</label>
          <input 
            type="text" 
            id="neighborhood"
            name="neighborhood"
            class="form-control"
            [(ngModel)]="addressData.neighborhood"
            maxlength="255"
            #neighborhood="ngModel"
            placeholder="Digite o bairro">
        </div>

        <!-- Cidade -->
        <div class="form-group">
          <label for="city" class="form-label optional-field">Cidade</label>
          <input 
            type="text" 
            id="city"
            name="city"
            class="form-control"
            [(ngModel)]="addressData.city"
            maxlength="255"
            #city="ngModel"
            placeholder="Digite a cidade">
        </div>

        <!-- Ponto de Referência -->
        <div class="form-group full-width">
          <label for="reference_point" class="form-label optional-field">Ponto de Referência</label>
          <input 
            type="text" 
            id="reference_point"
            name="reference_point"
            class="form-control"
            [(ngModel)]="addressData.reference_point"
            maxlength="255"
            #referencePoint="ngModel"
            placeholder="Próximo a...">
        </div>

        <!-- Botões -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="onCancel()">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!patientForm.form.valid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            {{ isLoading ? (isEditing ? 'Salvando...' : 'Salvando...') : (isEditing ? 'Atualizar Paciente' : 'Salvar Paciente') }}
          </button>
        </div>

        <!-- Mensagem de sucesso/erro -->
        <div *ngIf="successMessage" class="alert alert-success mt-3">
          {{ successMessage }}
        </div>
        
        <div *ngIf="errorMessage" class="alert alert-danger mt-3">
          {{ errorMessage }}
        </div>

      </form>
    </div>
  </div>
</div> 